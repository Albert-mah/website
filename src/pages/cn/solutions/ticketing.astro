---
import BaseCN from "../../../layouts/BaseCN.astro";
import ShapeFooter from "../../../components/ShapeFooter.astro";
import InteractiveDemo from "../../../components/InteractiveDemo.astro";
import { listPluginCategories } from "../../../utils";

// 导入交互演示数据
import extensionDemoGuides from "../../../data/ticketing-extension-demo-cn.json";

// 获取插件数据
const pluginData = await listPluginCategories();
const allPlugins = pluginData.flatMap((group: any) => group.plugins);

// 定义工单系统中使用的插件名称映射
const ticketingPluginNames = [
  "Email Manager",
  "Collection: Comment",
  "File Manager",
  "Action: Import records(Pro)",
  "Action: Export records(Pro)",
  "Custom variables"
];

// 根据插件名称匹配插件数据
function findPluginByName(name: string) {
  return allPlugins.find((plugin: any) => 
    plugin.name === name || 
    plugin.name_cn === name ||
    plugin.package_name?.includes(name.toLowerCase())
  );
}

// 获取工单系统相关插件
const ticketingPlugins = ticketingPluginNames.map(name => findPluginByName(name)).filter(Boolean);

// 调试信息
console.log('Found plugins:', ticketingPlugins.map(p => p?.name || p?.name_cn));
---

<BaseCN
  title="高效便捷的工单管理系统"
  description="NocoBase 工单管理系统作为 CRM 的重要补充，提供完整的工单生命周期管理，从客户联系人创建到工单分配处理，全流程数字化管理。"
  keywords="NocoBase 工单系统, 工单管理, 客服系统, 售后服务, 工单分配"
>
  <!-- Hero/Banner Start -->
  <section class="bg-half-170 bg-light d-table w-100">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6 col-md-7 order-1 order-md-1">
          <div class="title-heading">
            <h1 class="fw-bold mt-2 mb-3">高效便捷的<br/>工单管理系统</h1>
            <p class="para-desc text-muted">NocoBase 工单管理系统作为 CRM 的重要补充，提供完整的工单生命周期管理。从客户联系人创建到工单录入、分配、处理和跟踪，实现售后服务的全流程数字化管理。</p>
            <div class="mt-3 p-2" style="background-color: #f8f9fa; border-left: 3px solid #2f55d4; border-radius: 4px;">
              <small class="text-muted">
                <i class="uil uil-info-circle"></i> 基于 NocoBase 1.x 搭建（2.0 准备中）
              </small>
            </div>

            <!-- 标签 -->
            <div class="row mt-4">
              <div class="col-auto">
                <div class="d-flex align-items-center">
                  <span class="text-muted me-2">适用场景：</span>
                  <span class="badge bg-soft-primary me-2">客户服务</span>
                  <span class="badge bg-soft-primary">售后支持</span>
                </div>
              </div>
            </div>

            <!-- 开发者信息 -->
            <div class="row mt-4">
              <div class="col-auto">
                <div class="d-flex align-items-center">
                  <span class="text-muted me-2">开发者：</span>
                  <a href="https://www.nocobase.com" target="_blank" class="text-primary text-decoration-none fw-medium">NocoBase</a>
                </div>
              </div>
            </div>

            <!-- 按钮 -->
            <div class="mt-4 pt-2">
              <a href="https://demo-cn.nocobase.com/new" target="_blank" class="btn btn-primary me-3">
                <i class="uil uil-play me-1"></i>Live demo
              </a>
              <a href="#copy-tutorial" class="btn btn-outline-primary">
                <i class="uil uil-copy me-1"></i>复制到自己的环境
              </a>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-6 col-md-5 order-2 order-md-2 mt-4 pt-2 mt-sm-0 pt-sm-0">
          <div class="text-center">
            <!-- 工单系统预览图 -->
            <div class="position-relative">
              <img 
                src="https://static-docs.nocobase.com/img_v3_02o5_a2422688-f176-4c84-bf32-5ee0774f919g-1.png" 
                alt="NocoBase 工单管理系统预览" 
                class="img-fluid rounded shadow"
                style="max-height: 400px; object-fit: cover;"
              />
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div> <!--end container-->
  </section><!--end section-->
  <!-- Hero/Banner End -->

  <!-- Features Start -->
  <section class="section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="section-title text-center mb-4 pb-2">
            <h4 class="title mb-4">NocoBase 工单管理系统功能特点</h4>
            <p class="para-desc mx-auto text-muted mb-0">作为 CRM 系统的重要补充，提供专业的客户服务和售后支持管理</p>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <div class="row">
        <div class="col-lg-3 col-md-6 mt-4 pt-2">
          <div class="card border-0 features feature-primary feature-clean course-feature p-4 overflow-hidden shadow h-100">
            <div class="icons text-start">
              <i class="uil uil-ticket rounded h3 mb-0"></i>
            </div>
            <div class="card-body p-0 mt-4">                                            
              <h5 class="title text-dark">完整的工单生命周期</h5>
              <p class="text-muted mt-2">从工单创建、分配、处理到关闭，全流程管理，确保每个工单都得到妥善处理</p>
              <i class="uil uil-ticket full-img"></i>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-3 col-md-6 mt-4 pt-2">
          <div class="card border-0 features feature-primary feature-clean course-feature p-4 overflow-hidden shadow h-100">
            <div class="icons text-start">
              <i class="uil uil-users-alt rounded h3 mb-0"></i>
            </div>
            <div class="card-body p-0 mt-4">                                            
              <h5 class="title text-dark">智能分配与跟踪</h5>
              <p class="text-muted mt-2">根据工单类型和团队成员技能自动分配任务，实时跟踪处理进度和状态</p>
              <i class="uil uil-users-alt full-img"></i>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-3 col-md-6 mt-4 pt-2">
          <div class="card border-0 features feature-primary feature-clean course-feature p-4 overflow-hidden shadow h-100">
            <div class="icons text-start">
              <i class="uil uil-envelope rounded h3 mb-0"></i>
            </div>
            <div class="card-body p-0 mt-4">                                            
              <h5 class="title text-dark">多渠道沟通记录</h5>
              <p class="text-muted mt-2">通过 API 同步邮件、电话、在线聊天等多种沟通渠道，统一管理客户交流记录</p>
              <i class="uil uil-envelope full-img"></i>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-3 col-md-6 mt-4 pt-2">
          <div class="card border-0 features feature-primary feature-clean course-feature p-4 overflow-hidden shadow h-100">
            <div class="icons text-start">
              <i class="uil uil-shield-check rounded h3 mb-0"></i>
            </div>
            <div class="card-body p-0 mt-4">                                            
              <h5 class="title text-dark">开源，数据完全掌控</h5>
              <p class="text-muted mt-2">开源代码，数据私有部署，确保企业数据安全和自主控制</p>
              <i class="uil uil-shield-check full-img"></i>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- Features End -->

  <!-- Try Ticketing Extension Start -->
  <section class="section bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 text-center">

        <div class="mt-4" id="ticket-demo-wrap">
          <!-- 使用扩展功能交互演示 -->
          <InteractiveDemo guides={extensionDemoGuides}  />
        </div><!--end ticket-demo-wrap-->

        <div class="row justify-content-center mt-4">
          <div class="col-12 text-center">
            <div class="mt-4 pt-2">
              <a href="https://demo-cn.nocobase.com/new" target="_blank" class="btn btn-primary me-3">
                <i class="uil uil-play me-1"></i>立即体验
              </a>
              <a href="#copy-tutorial" class="btn btn-outline-primary">
                <i class="uil uil-copy me-1"></i>复制到自己的环境
              </a>
            </div>
          </div><!--end col-->
        </div><!--end row-->
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- Try Ticketing Extension End -->

  <!-- Development Tutorial Start -->
  <section class="section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="section-title text-center mb-4 pb-2">
            <h4 class="title mb-4">工单系统开发教程</h4>
            <p class="para-desc mx-auto text-muted mb-0">从零开始学习如何使用 NocoBase 构建专业的工单管理系统</p>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <div class="row">
        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex flex-column">
              <div class="icon text-primary text-center">
                <i class="uil uil-play h2 mb-3"></i>
              </div>
              <div class="flex-grow-1">
                <h5 class="mb-3 text-center">数据模型设计</h5>
                <p class="text-muted text-center">学习如何创建工单、客户、分类等基础数据结构和关系</p>
              </div>
              <div class="text-center">
                <button class="btn btn-outline-secondary btn-sm">即将推出</button>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex flex-column">
              <div class="icon text-primary text-center">
                <i class="uil uil-arrow-growth h2 mb-3"></i>
              </div>
              <div class="flex-grow-1">
                <h5 class="mb-3 text-center">工作流配置</h5>
                <p class="text-muted text-center">设置工单分配、状态流转和自动化处理流程</p>
              </div>
              <div class="text-center">
                <button class="btn btn-outline-secondary btn-sm">即将推出</button>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex flex-column">
              <div class="icon text-primary text-center">
                <i class="uil uil-bell h2 mb-3"></i>
              </div>
              <div class="flex-grow-1">
                <h5 class="mb-3 text-center">通知与提醒</h5>
                <p class="text-muted text-center">配置邮件和系统通知，确保工单及时处理</p>
              </div>
              <div class="text-center">
                <button class="btn btn-outline-secondary btn-sm">即将推出</button>
              </div>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- Development Tutorial End -->

  <!-- Commercial Plugins Start -->
  <section class="section bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="section-title text-center mb-4 pb-2">
            <h4 class="title mb-4">工单系统中所使用的商业插件介绍</h4>
            <p class="para-desc mx-auto text-muted mb-0">了解如何通过商业插件获得更强大的功能，提升工单系统的专业性和易用性</p>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <div class="row pb-4">
        <!-- 动态生成插件卡片 -->
        {ticketingPlugins.map((plugin) => {
          if (!plugin) return null;
          
          const displayName = plugin.name_cn || plugin.name;
          const displayDescription = plugin.description_cn || plugin.description;
          const docsUrl = plugin.docs_cn || plugin.docs;
          
          return (
            <div class="col-lg-4 col-md-6 col-12 pt-0 pb-4">
              <div title={displayName} style="color: inherit;" class="card rounded shadow border-0 plugin-card h-100">
                <div class="card-body">
                  <div class="mt-2 plugin-box">
                    <h6 class="card-title mb-1">{displayName}</h6>
                    <div class="plugin-developer text-muted mb-3">By <span>{plugin.developer || 'NocoBase'}</span></div>
                    <p class="text-muted mb-2 plugin-overview">{displayDescription}
                      {docsUrl && (
                        <a href={docsUrl} target="_blank" style="font-size: 14px;margin-left: 5px;">详情</a>
                      )}
                    </p>
                    {plugin.commercial && (
                      <div class="plugin-footer">
                        <h6 class="text-primary mb-0">
                          <span class="text-muted" style="font-weight: normal;font-style: italic;font-size: 12px;">永久使用, 1 年升级</span><br>
                          <a href="/cn/plugins-bundles"> {plugin.points_1_year || 0} <i class="uil uil-moon-eclipse me-1"></i></a>
                          <span class="text-muted">/</span>
                          <span class="text-muted">￥{plugin.price_1_year_cn || 0}</span>
                        </h6>
                        <h6 class="text-muted mb-0" style="margin-left: auto;font-weight: normal;">
                          <span class="text-muted" style="font-weight: normal;font-style: italic;font-size: 12px;">永久使用和升级</span><br>
                          <a class="text-muted" href="/cn/plugins-bundles"> {plugin.point || 0} <i class="uil uil-moon-eclipse me-1"></i></a>
                          <span class="text-muted">/</span>
                          <span class="text-muted">￥{plugin.price_cny || 0}</span>
                        </h6>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          );
        })}

        <!-- 占位卡片，保持布局整齐 -->
        <div class="col-lg-4 col-md-6 col-12 pt-0 pb-4">
          <div class="card rounded shadow border-0 plugin-card h-100" style="opacity: 0.6;">
            <div class="card-body">
              <div class="mt-2 plugin-box text-center">
                <div class="mt-4 mb-4">
                  <i class="uil uil-plus-circle h2 text-muted mb-3"></i>
                  <h6 class="text-muted mb-3">更多插件即将推出</h6>
                  <p class="text-muted small">我们正在开发更多有用的商业插件，敬请期待</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!--end row-->

      <div class="row justify-content-center mt-4">
        <div class="col-12 text-center">
          <a href="/cn/plugins-commercial" class="btn btn-primary me-3">查看全部商业插件</a>
          <a href="/cn/commercial" class="btn btn-outline-primary">了解定价详情</a>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- Commercial Plugins End -->

  <!-- How to Use Start -->
  <section class="section" id="copy-tutorial">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="section-title text-center mb-4 pb-2">
            <h4 class="title mb-4">如何使用？</h4>
            <p class="para-desc mx-auto text-muted mb-0">三个步骤快速部署包含工单管理功能的 NocoBase CRM 系统到您的环境</p>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <div class="row">
        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 text-center features feature-clean course-feature p-4 shadow h-100">
            <div class="d-flex flex-column h-100">
              <div class="icons text-center">
                <i class="uil uil-download-alt h1 text-primary"></i>
              </div>
              <div class="content mt-4 flex-grow-1">
                <h5>安装 NocoBase 系统</h5>
                <p class="text-muted mt-2">按照我们的安装文档，部署 NocoBase 系统到您的服务器</p>
              </div>
              <div class="mt-3">
                <a href="https://docs-cn.nocobase.com/welcome/getting-started/installation" target="_blank" class="btn btn-primary">查看安装文档</a>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 text-center features feature-clean course-feature p-4 shadow h-100">
            <div class="d-flex flex-column h-100">
              <div class="icons text-center">
                <i class="uil uil-cloud-download h1 text-primary"></i>
              </div>
              <div class="content mt-4 flex-grow-1">
                <h5>下载 CRM 系统模板文件</h5>
                <p class="text-muted mt-2">下载完整的 CRM 模板即可获得工单管理能力</p>
              </div>
              <div class="mt-3">
                <div>
                  <a href="https://static-docs.nocobase.com/pm_demo/demo_cn_250910.zip" class="text-muted small" style="text-decoration: underline !important;">下载 SQL 文件</a>
                </div>
                <a href="https://static-docs.nocobase.com/pm_demo/demo_cn_20250910.nbdata" class="btn btn-outline-primary">下载备份文件 (.nbdata)</a>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-4 col-md-6 mt-4 pt-2">
          <div class="card border-0 text-center features feature-clean course-feature p-4 shadow h-100">
            <div class="d-flex flex-column h-100">
              <div class="icons text-center">
                <i class="uil uil-upload h1 text-primary"></i>
              </div>
              <div class="content mt-4 flex-grow-1">
                <h5>在系统内还原</h5>
                <p class="text-muted mt-2">将 CRM 模板文件导入到您的 NocoBase 系统中，即可同时获得 CRM 和工单管理功能</p>
              </div>
              <div class="mt-3">
                <a href="/cn/tutorials/nocobase-crm-demo-deployment-guide" class="btn btn-outline-primary">还原教程</a>
              </div>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <!-- 工单功能说明 -->
      <div class="row justify-content-center mt-5">
        <div class="col-lg-8">
          <div class="alert border-0 shadow-sm" style="background: #f8f9fa; border-left: 4px solid #007bff !important;">
            <div class="d-flex align-items-start">
              <div class="flex-shrink-0 me-3">
                <i class="uil uil-info-circle h4 text-primary mb-0"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-2 text-dark fw-medium">提示</h6>
                <p class="mb-0 text-muted">工单管理系统作为 CRM 的重要补充模块，已完全集成在 CRM 模板中。部署完成后，您可以在 CRM 系统中直接使用完整的工单管理功能，实现客户服务的全流程管理。</p>
              </div>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- How to Use End -->

  <!-- How to Extend Start -->
  <section class="section bg-light">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="section-title text-center mb-4 pb-2">
            <h4 class="title mb-4">如何扩展？</h4>
            <p class="para-desc mx-auto text-muted mb-0">根据业务需求进一步扩展和定制您的工单管理系统</p>
          </div>
        </div><!--end col-->
      </div><!--end row-->

      <div class="row">
        <div class="col-lg-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex">
              <div class="icon text-primary">
                <i class="uil uil-plus-circle h2"></i>
              </div>
              <div class="ms-3 d-flex flex-column flex-grow-1">
                <div class="flex-grow-1">
                  <h5 class="mb-2">工单类型与分类管理</h5>
                  <p class="text-muted mb-3">根据业务需要创建不同类型的工单分类和处理规则</p>
                </div>
                <div>
                  <button class="btn btn-sm btn-outline-secondary">即将推出</button>
                </div>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex">
              <div class="icon text-primary">
                <i class="uil uil-users-alt h2"></i>
              </div>
              <div class="ms-3 d-flex flex-column flex-grow-1">
                <div class="flex-grow-1">
                  <h5 class="mb-2">团队协作功能</h5>
                  <p class="text-muted mb-3">设置团队角色、权限和协作工作流</p>
                </div>
                <div>
                  <button class="btn btn-sm btn-outline-secondary">即将推出</button>
                </div>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex">
              <div class="icon text-primary">
                <i class="uil uil-chart-line h2"></i>
              </div>
              <div class="ms-3 d-flex flex-column flex-grow-1">
                <div class="flex-grow-1">
                  <h5 class="mb-2">统计报表分析</h5>
                  <p class="text-muted mb-3">构建工单处理情况和效率分析报表</p>
                </div>
                <div>
                  <button class="btn btn-sm btn-outline-secondary">即将推出</button>
                </div>
              </div>
            </div>
          </div>
        </div><!--end col-->

        <div class="col-lg-6 mt-4 pt-2">
          <div class="card border-0 shadow rounded h-100">
            <div class="card-body p-4 d-flex">
              <div class="icon text-primary">
                <i class="uil uil-link-h h2"></i>
              </div>
              <div class="ms-3 d-flex flex-column flex-grow-1">
                <div class="flex-grow-1">
                  <h5 class="mb-2">CRM 系统集成</h5>
                  <p class="text-muted mb-3">与现有 CRM 系统无缝集成，实现数据共享</p>
                </div>
                <div>
                  <button class="btn btn-sm btn-outline-secondary">即将推出</button>
                </div>
              </div>
            </div>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- How to Extend End -->

  <!-- CTA Section Start -->
  <section class="section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 text-center">
          <h3 class="title mb-4">准备好使用 NocoBase 工单管理系统了吗？</h3>
          <p class="text-muted para-desc mx-auto mb-0">
            1 分钟时间部署一个专属工单管理 demo。作为 CRM 的重要补充，实现完整的客户服务体系，提升客户满意度和服务效率。
          </p>
          <div class="mt-4">
            <a href="https://demo-cn.nocobase.com/new" target="_blank" class="btn btn-primary mt-2 me-3">
              <i class="uil uil-play me-1"></i>Live demo
            </a>
            <a href="#copy-tutorial" class="btn btn-outline-primary mt-2">
              <i class="uil uil-copy me-1"></i>复制到自己的环境
            </a>
          </div>
        </div><!--end col-->
      </div><!--end row-->
    </div><!--end container-->
  </section><!--end section-->
  <!-- CTA Section End -->

  <ShapeFooter />
</BaseCN>

<style>
/* 工单管理系统样式 - 参考 CRM 页面样式 */
#ticket-demo-wrap {
  position: relative;
}

/* 商业插件卡片样式 */
.plugin-card {
  transition: all 0.3s ease;
}

.plugin-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.plugin-footer {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-top: auto;
}

.plugin-footer .badge {
  font-size: 0.7rem;
  padding: 0.2rem 0.4rem;
}

.plugin-developer span {
  color: #6c757d;
}

.plugin-overview {
  font-size: 0.9rem;
  line-height: 1.5;
}

.plugin-footer h6 {
  font-size: 0.8rem;
}

.plugin-box {
  display: flex;
  flex-direction: column;
  height: 100%;
}

</style>

 